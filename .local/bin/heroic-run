#!/usr/bin/env bash

exec bwrap \
    --symlink usr/lib /lib \
    --symlink usr/lib64 /lib64 \
    --symlink usr/bin /bin \
    --symlink usr/bin /sbin \
    --ro-bind /usr/lib /usr/lib \
    --ro-bind /usr/lib64 /usr/lib64 \
    --ro-bind /usr/bin /usr/bin \
    --ro-bind /etc /etc \
    --ro-bind /usr/share /usr/share \
    --ro-bind /opt/heroic* /opt/heroic*   \
    --dev /dev \
    --dev-bind /dev/dri /dev/dri \
    --dev-bind /dev/nvidia0 /dev/nvidia0    \
    --dev-bind /dev/nvidiactl /dev/nvidiactl    \
    --dev-bind /dev/nvidia-modeset /dev/nvidia-modeset    \
    --proc /proc    \
    --ro-bind /sys /sys     \
    --bind $HOME/.local/share/sandbox/heroic /home   \
    --bind /run/user/$UID /run/user/$UID     \
    --bind /run/dbus /run/dbus     \
    --bind /tmp/dbus* /tmp/dbus*    \
    --ro-bind ~/.config/fontconfig ~/.config/fontconfig     \
    --ro-bind ~/.config/pipewire ~/.config/pipewire \
    --ro-bind ~/.config/dconf ~/.config/dconf   \
    --bind ~/.cache/fontconfig ~/.cache/fontconfig      \
    --bind ~/.config/gtk-3.0 ~/.config/gtk-3.0  \
    --hostname sandbox  \
    --unshare-all \
    --share-net \
    --die-with-parent \
    --new-session   \
    /usr/bin/heroic-run --ozone-platform=wayland
