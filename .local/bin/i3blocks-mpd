#!/usr/bin/env bash
# @author nate zhou
# @since 2025

. "${HOME}/.cache/wal/colors.sh"
play_icon=" "
pause_icon=""
stop_icon=""
color="$color1"
pid="${HOME}/.config/mpd/mpd.pid"
# sed: remove parentheses`()`, trailing spaces, and ampersand `&` because they break pango
title="$(mpc current -f "[%title%]" | sed 's/([^()]*)//g; s/[[:space:]-]*$//; s/[&]//g' | cut -c1-40 )"
# title="$(mpc current)"

# ` `(U+2009) is the Thin Space
if [ -f "$pid" ] ; then
	if [ -z "$(mpc status | sed -n '2p')" ] ; then
		echo "<span foreground='$color1'>$stop_icon  no song</span>" 
		echo
	else
		echo "<span foreground='$color1'>$play_icon</span>""<small>$title</small>"
		echo
		if [[ -z "$title" || "$(mpc status | sed -n '2p' )" =~ '[paused]' ]]; then
            color="#888888"
		fi
	fi
	echo "$color"
fi



case $BLOCK_BUTTON in
    2) mpc toggle>/dev/null &
        ;;
    3) notify-send -u low -r 3301 "$icon $(basename $0)" "$(mpc current)"
        ;;
    #4) mpc prev>/dev/null &
    #    ;;
    #5) mpc next>/dev/null &
    #    ;;
esac

